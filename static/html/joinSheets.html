<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>Join Sheets</title>
		<script src="../kendoui/js/jquery.min.js"></script>
		<script src="../kendoui/js/jszip.min.js"></script>
		<script src="../kendoui/js/kendo.all.min.js"></script>
		<script src="../kendoui/examples/content/shared/js/console.js"></script>
		
		<script src="/static/js/joinSheetsHandler.js"></script>

		<link rel="stylesheet" href="/static/css/joinSheets.css">
		<link href="../kendoui/examples/content/shared/styles/examples-offline.css" rel="stylesheet">
		<link href="../kendoui/styles/kendo.common.min.css" rel="stylesheet">
		<link href="../kendoui/styles/kendo.rtl.min.css" rel="stylesheet">
		<link href="../kendoui/styles/kendo.default.min.css" rel="stylesheet">
		<link href="../kendoui/styles/kendo.default.mobile.min.css" rel="stylesheet">
	</head>

	<body>
		<div id="grid"></div>
		<button id="submit" type="button">Submit</button>
		<script id="popupTemplate" type="text/x-kendo-template">

			<div class="k-edit-label">
				<label for="LeftSheet">LeftSheet:</label>
			</div>
			<div class="k-edit-field">
				<input id="LeftSheet" name="LeftSheet" data-bind="value:LeftSheet" required />
				<span class="k-invalid-msg" data-for="LeftSheet"></span>
			</div>


			<div class="k-edit-label">
				<label for="LeftSheetColumn">LeftSheetColumn:</label>
			</div>
			<div class="k-edit-field">
				<input id="LeftSheetColumn" name="LeftSheetColumn" data-bind="value:LeftSheetColumn" required />
				<span class="k-invalid-msg" data-for="LeftSheetColumn"></span>
			</div>


			<div class="k-edit-label">
				<label for="RightSheet">RightSheet:</label>
			</div>
			<div class="k-edit-field">
				<input id="RightSheet" name="RightSheet" data-bind="value:RightSheet" required />
				<span class="k-invalid-msg" data-for="RightSheet"></span>
			</div>


			<div class="k-edit-label">
				<label for="RightSheetColumn">RightSheetColumn:</label>
			</div>
			<div class="k-edit-field">
				<input id="RightSheetColumn" name="RightSheetColumn" data-bind="value:RightSheetColumn" required />
				<span class="k-invalid-msg" data-for="RightSheetColumn"></span>
			</div>
		</script>

		<script>
			initialization();
			$(function () {
				var gridData = [];

				var gridDataNextID = gridData.length + 1;

				var gridDataSource = new kendo.data.DataSource({
					transport: {
						read: function (options) {
							options.success(gridData);
						},
						update: function (options) {
							options.success();
						},
						create: function (options) {
							var toPush = {
								ID: gridDataNextID++,
								LeftSheet: options.data['LeftSheet']['sheetId'],
								LeftSheetColumn: options.data['LeftSheetColumn']['columnId'],
								RightSheet: options.data['RightSheet']['sheetId'],
								RightSheetColumn: options.data['RightSheetColumn']['columnId'],
							}
							gridData.push(toPush);
							options.success(toPush);
						},
						destroy: function (options) {
							options.success();
						}
					},
					schema: {
						model: {
							id: "ID",
							fields: {
								ID: { type: "number", editable: false },
								LeftSheet: { defaultValue: null },
								LeftSheetColumn: { defaultValue: null },
								RightSheet: { defaultValue: null },
								RightSheetColumn: { defaultValue: null },
							}
						}
					}
				});

				function initDropDownLists() {
					var LeftSheet = $("#LeftSheet").kendoDropDownList({
						dataTextField: "name",
						dataValueField: "sheetId",
						dataSource: window.mapping['sheets']
					}).data("kendoDropDownList");

					var LeftSheetColumn = $("#LeftSheetColumn").kendoDropDownList({
						cascadeFrom: "LeftSheet",
						dataTextField: "name",
						dataValueField: "columnId",
						dataSource: window.mapping['columns']
					}).data("kendoDropDownList");

					var RightSheet = $("#RightSheet").kendoDropDownList({
						dataTextField: "name",
						dataValueField: "sheetId",
						dataSource: window.mapping['sheets']
					}).data("kendoDropDownList");

					var RightSheetColumn = $("#RightSheetColumn").kendoDropDownList({
						cascadeFrom: "RightSheet",
						dataTextField: "name",
						dataValueField: "columnId",
						dataSource: window.mapping['columns']
					}).data("kendoDropDownList");
				}

				$("#grid").kendoGrid({
					columns: [
						{ 
							field: "LeftSheet", 
							title: "Left Sheet", 
							template: "#= sheetName(LeftSheet) #" 
						},{ 
							field: "LeftSheetColumn", 
							title: "Left Sheet Column", 
							template: "#= columnName(LeftSheetColumn) #" 
						},{ 
							field: "RightSheet", 
							title: "Right Sheet", 
							template: "#= sheetName(RightSheet) #" 
						},{ 
							field: "RightSheetColumn", 
							title: "Right Sheet Column", 
							template: "#= columnName(RightSheetColumn) #" 
						},{ command: [{ 
								className: "btn-destroy", 
								name: "destroy", 
								text: "Remove"
							},{
								className: "btn-edit",
								name: "edit",
								text: "Edit"
							}] 
						}
					],
					toolbar: [
						"create",
						{
							template: `
								<a role="button" class="k-button k-button-icontext" href="\\#" onclick="submitHandler();">
									<span class="k-icon k-i-check"></span>Submit
								</a>`
						}],
					editable: { mode: "popup", window: { width: 600 }, template: $("#popupTemplate").html() },
					edit: function (e) {
						initDropDownLists();
					},
					autoBind: true,
					dataSource: gridDataSource
				});
			});
		</script>

		<script>
			$("#submit").kendoButton({
				enable: true,
				click: function(e) {
					console.log(e.event.target.tagName);
				}
			});
		</script>
	</body>
</html>